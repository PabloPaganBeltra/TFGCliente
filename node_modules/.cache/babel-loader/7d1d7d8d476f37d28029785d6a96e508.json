{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Pablo PC/Desktop/Carpeta/AproyectosReact/MERNTasks/cliente/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Pablo PC/Desktop/Carpeta/AproyectosReact/MERNTasks/cliente/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Pablo PC/Desktop/Carpeta/AproyectosReact/MERNTasks/cliente/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'./authContext';import AuthReducer from'./authReducer';import clienteAxios from'../../config/axios';import tokenAuth from'../../config/tokenAuth';import{REGISTRO_EXITOSO,REGISTRO_ERROR,OBTENER_USUARIO,LOGIN_EXITOSO,LOGIN_ERROR,CERRAR_SESION}from'../../types';import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),autenticado:null,usuario:null,mensaje:null,cargando:true};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//funciones para registrar los usuarios\nvar registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post('/api/usuarios',datos);case 3:respuesta=_context.sent;//console.log(respuesta.data);\ndispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});//Obtener usuario\nusuarioAutenticado();_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);//console.log(error.response.data.msg);\nalerta={msg:_context.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:REGISTRO_ERROR,payload:alerta});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();//devolver usuario autenticado\nvar usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem('token');if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get('/api/auth');case 5:respuesta=_context2.sent;//console.log(respuesta);\ndispatch({type:OBTENER_USUARIO,payload:respuesta.data.usuario});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0);dispatch({type:LOGIN_ERROR});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();//usuario iniciando sesion\nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post('/api/auth',datos);case 3:respuesta=_context3.sent;console.log(respuesta);dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});//Obtener usuario\nusuarioAutenticado();_context3.next=14;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0.response.data.msg);alerta={msg:_context3.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:REGISTRO_ERROR,payload:alerta});case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();//cierra sesion del usuario\nvar cerrarSesion=function cerrarSesion(){dispatch({type:CERRAR_SESION});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,registrarUsuario:registrarUsuario,iniciarSesion:iniciarSesion,usuarioAutenticado:usuarioAutenticado,cerrarSesion:cerrarSesion},children:props.children});};export default AuthState;","map":{"version":3,"sources":["C:/Users/Pablo PC/Desktop/Carpeta/AproyectosReact/MERNTasks/cliente/src/context/autenticacion/authState.js"],"names":["React","useReducer","AuthContext","AuthReducer","clienteAxios","tokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_ERROR","CERRAR_SESION","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","datos","post","respuesta","type","payload","data","usuarioAutenticado","alerta","msg","response","categoria","get","console","log","iniciarSesion","cerrarSesion","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\r\nimport AuthContext from './authContext';\r\nimport AuthReducer from './authReducer';\r\n\r\nimport clienteAxios from '../../config/axios';\r\nimport tokenAuth from '../../config/tokenAuth';\r\n\r\nimport { \r\n    REGISTRO_EXITOSO,\r\n    REGISTRO_ERROR,\r\n    OBTENER_USUARIO,\r\n    LOGIN_EXITOSO,\r\n    LOGIN_ERROR,\r\n    CERRAR_SESION\r\n } from '../../types';\r\n\r\n const AuthState = props =>{\r\n\r\n    const initialState = {\r\n        token: localStorage.getItem('token'),\r\n        autenticado: null,\r\n        usuario: null,\r\n        mensaje: null,\r\n        cargando: true\r\n    }\r\n\r\n    const [ state, dispatch ] = useReducer(AuthReducer, initialState);\r\n\r\n    //funciones para registrar los usuarios\r\n    const registrarUsuario = async datos=>{\r\n        try {\r\n            \r\n            const respuesta = await clienteAxios.post('/api/usuarios', datos );\r\n            //console.log(respuesta.data);\r\n\r\n            dispatch({\r\n                type: REGISTRO_EXITOSO,\r\n                payload: respuesta.data\r\n            });\r\n\r\n            //Obtener usuario\r\n            usuarioAutenticado();\r\n\r\n        } catch (error) {\r\n            //console.log(error.response.data.msg);\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'alerta-error'\r\n            }\r\n\r\n            dispatch({\r\n                type: REGISTRO_ERROR,\r\n                payload: alerta\r\n            });\r\n        }\r\n    }\r\n\r\n    //devolver usuario autenticado\r\n    const usuarioAutenticado = async () =>{\r\n        const token = localStorage.getItem('token');\r\n        if(token){\r\n            tokenAuth(token);\r\n\r\n        }\r\n\r\n        try {\r\n            const respuesta = await clienteAxios.get('/api/auth');\r\n            //console.log(respuesta);\r\n            dispatch({\r\n                type: OBTENER_USUARIO,\r\n                payload: respuesta.data.usuario\r\n            });\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n            dispatch({\r\n                type: LOGIN_ERROR\r\n            })\r\n        }\r\n    }\r\n\r\n    //usuario iniciando sesion\r\n    const iniciarSesion = async datos =>{\r\n        try {\r\n            const respuesta = await clienteAxios.post('/api/auth', datos);\r\n            console.log(respuesta);\r\n            dispatch({\r\n                type: LOGIN_EXITOSO,\r\n                payload: respuesta.data\r\n            });\r\n\r\n            //Obtener usuario\r\n            usuarioAutenticado();\r\n        } catch (error) {\r\n            console.log(error.response.data.msg);\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'alerta-error'\r\n            }\r\n\r\n            dispatch({\r\n                type: REGISTRO_ERROR,\r\n                payload: alerta\r\n            });\r\n        }\r\n    }\r\n\r\n    //cierra sesion del usuario\r\n    const cerrarSesion = ()=>{\r\n        dispatch({\r\n            type: CERRAR_SESION\r\n        });\r\n    }\r\n\r\n\r\n    return(\r\n        <AuthContext.Provider\r\n            value ={{\r\n                token: state.token,\r\n                autenticado: state.autenticado,\r\n                usuario: state.usuario,\r\n                mensaje: state.mensaje,\r\n                cargando: state.cargando,\r\n                registrarUsuario,\r\n                iniciarSesion,\r\n                usuarioAutenticado,\r\n                cerrarSesion\r\n            }}\r\n        >{ props.children }\r\n\r\n        </AuthContext.Provider>\r\n    )\r\n }\r\n\r\n export default AuthState;"]},"metadata":{},"sourceType":"module"}